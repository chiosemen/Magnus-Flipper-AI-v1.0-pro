#!/bin/zsh

REPO_DIR="$HOME/Developer/Magnus-Flipper-AI-v1.0-pro"
REMOTE_URL="https://github.com/chiosemen/Magnus-Flipper-AI-v1.0-.git"

echo "ğŸ“‚ Using repo directory: $REPO_DIR"
cd "$REPO_DIR" || { echo "âŒ Cannot cd into repo"; exit 1; }

echo "ğŸ” Checking for .git folder..."
if [ ! -d ".git" ]; then
  echo "âš ï¸ No .git directory found â€” initializing repo..."
  git init
  git remote add origin "$REMOTE_URL"
  git branch -M main
else
  echo "âœ… .git found â€” continuing..."
fi

echo "ğŸ§¹ Cleaning old Git locks..."
rm -f .git/index.lock .git/HEAD.lock 2>/dev/null

echo "ğŸ—ƒ Staging all files..."
git add -A

echo "ğŸ’¬ Committing..."
git commit -m "Magnus Global Restore: Full monorepo sync after rsync recovery" || \
echo "âš ï¸ No changes to commit â€” continuing."

echo "ğŸ“¡ Remote:"
git remote -v

echo "ğŸš€ Performing SAFE FORCE push..."
git push origin main --force-with-lease

echo "ğŸ”„ Validating..."
git fetch origin main
git status

echo "ğŸ‰ DONE â€” Monorepo successfully pushed!"
